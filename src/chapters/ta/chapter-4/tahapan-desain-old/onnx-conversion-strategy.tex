\subsubsubsection{Tantangan Konversi VisionEncoderDecoderModel}
Arsitektur \donut{} yang berbasis \textit{VisionEncoderDecoderModel} memiliki karakteristik yang kompleks untuk dikonversi ke format \onnx{}. Karakteristik model ini mencakup:

\begin{enumerate}
    \item \textbf{Tied Weights Mechanism}: Decoder component menggunakan \emph{tied weights} antara embedding layer dan output layer yang tidak dapat diekspor secara langsung oleh TorchScript karena keterbatasan pada static graph requirements.
    
    \item \textbf{Dynamic Shape Handling}: Model mendukung variable image resolutions dan menghasilkan text sequences dengan panjang berbeda-beda, memerlukan dynamic position encoding interpolation yang tidak kompatibel dengan static shape requirements pada mobile inference frameworks.
    
    \item \textbf{Autoregressive Generation}: Proses text generation menggunakan metode autoregressive yang memerlukan iterative token generation dengan \texttt{generate()} method, dimana method ini menjadi tidak tersedia setelah proses konversi TorchScript.
    
    \item \textbf{Cross-Attention Complexity}: Mekanisme cross-attention antara vision encoder dan text decoder memerlukan dynamic masking berdasarkan actual sequence lengths, dengan attention matrices yang scale dengan vision\_sequence\_length Ã— text\_sequence\_length.
\end{enumerate}

\subsubsubsection{Metodologi Konversi Bertahap}
\label{subsubsubsec:metodologi-konversi-bertahap}
Untuk mengatasi tantangan tersebut, dirancang metodologi konversi bertahap yang memisahkan komponen encoder dan decoder:

\begin{enumerate}
    \item \textbf{Component Separation}: Pemisahan model menjadi dua komponen terpisah - vision encoder (\swin{} transformer) dan text decoder (BART-based) yang dapat dikonversi secara independen.
    
    \item \textbf{Custom Generation Loop}: Implementasi custom autoregressive generation loop pada application level untuk menggantikan built-in \texttt{generate()} method yang hilang setelah konversi.
    
    \item \textbf{Static Shape Optimization}: Penetapan fixed input shapes untuk optimasi inference speed dengan trade-off pada fleksibilitas input image resolution.
    
    \item \textbf{Past Key Values Management}: Implementasi manual handling untuk past\_key\_values tensors yang diperlukan untuk efficient autoregressive generation.
\end{enumerate}